---
description: Generate branded HTML analysis reports for Nimrod Fisher | AI Analytics Hub
globs:
  - "**/*analysis*.py"
  - "**/*report*.py"
  - "**/*eda*.py"
alwaysApply: false
---

# HTML Report Generation Rule

When generating HTML reports at the end of an analysis, apply this branded template.

## Branding
- **Author**: Nimrod Fisher | AI Analytics Hub
- **Website**: ai-analytics-hub.com
- **Footer**: "The Analytics Team"
- **Logo**: `.cursor/assets/logo.png` (or `.jpg`, `.jpeg`, `.svg`) - Analytics Hub logo (embed as base64 in reports)
- **Profile Image**: `.cursor/assets/logo.jpg` (embed as base64 in reports)

## Color Palette
```
Primary:        #2563EB (headers, links)
Primary Dark:   #1E40AF (hover states)
Secondary:      #0EA5E9 (accents, charts)
Background:     #F8FAFC (page bg)
Surface:        #FFFFFF (cards)
Text:           #1E293B (main text)
Text Secondary: #64748B (captions)
Border:         #E2E8F0 (dividers)
Success:        #10B981 (positive metrics)
Warning:        #F59E0B (caution)
Error:          #EF4444 (negative metrics)
```

## Chart Colors (in order)
1. `#2563EB` 2. `#0EA5E9` 3. `#10B981` 4. `#F59E0B` 5. `#8B5CF6` 6. `#EC4899` 7. `#64748B`

## Required Section Structure
1. **Header** - Analytics Hub logo (top-left), title, date, author name
2. **Executive Summary** - Blue gradient box with key findings
3. **Methodology** - Data sources, approach, limitations
4. **Findings** - Analysis with visualizations
5. **Recommendations** - Green gradient box with actionable insights
6. **Footer** - "The Analytics Team • ai-analytics-hub.com"

## Typography
- Google Fonts: Inter (headings 600-700, body 400), JetBrains Mono (code)
- Load inline for self-contained HTML

## Key Components

### Metric Cards
```html
<div class="metrics-grid">
    <div class="metric-card positive"><div class="value">+24%</div><div class="label">Growth</div></div>
    <div class="metric-card negative"><div class="value">-8%</div><div class="label">Churn</div></div>
</div>
```

### Chart Container
```html
<div class="chart-container">
    <div class="chart-title">Title</div>
    <div id="chart1" class="chart"></div>
</div>
```

### Callouts
```html
<div class="callout info">Note</div>
<div class="callout warning">Caution</div>
<div class="callout success">Positive</div>
```

## Technical Requirements
- Self-contained HTML (all CSS inline)
- Support ECharts and Plotly via CDN
- Print-friendly with proper page breaks
- Profile image as base64 data URI

## Full CSS Template

```css
:root {
    --color-primary: #2563EB;
    --color-primary-dark: #1E40AF;
    --color-secondary: #0EA5E9;
    --color-bg: #F8FAFC;
    --color-surface: #FFFFFF;
    --color-text: #1E293B;
    --color-text-secondary: #64748B;
    --color-border: #E2E8F0;
    --color-success: #10B981;
    --color-warning: #F59E0B;
    --color-error: #EF4444;
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-mono: 'JetBrains Mono', monospace;
}

body {
    font-family: var(--font-sans);
    font-size: 16px;
    line-height: 1.6;
    color: var(--color-text);
    background: var(--color-bg);
    padding: 2rem;
}

.report-container {
    max-width: 1000px;
    margin: 0 auto;
    background: var(--color-surface);
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}

.report-header {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    color: white;
    padding: 2rem 2.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.report-header img.logo {
    height: 48px;
    width: auto;
    object-fit: contain;
    filter: brightness(0) invert(1); /* Makes logo white on dark header */
}

.report-header img.profile {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.3);
    object-fit: cover;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--color-border);
}

.executive-summary {
    background: linear-gradient(135deg, #EFF6FF 0%, #F0F9FF 100%);
    border-left: 4px solid var(--color-primary);
    padding: 1.5rem;
    border-radius: 0 8px 8px 0;
}

.recommendations {
    background: linear-gradient(135deg, #ECFDF5 0%, #F0FDFA 100%);
    border-left: 4px solid var(--color-success);
    padding: 1.5rem;
    border-radius: 0 8px 8px 0;
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.metric-card {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.25rem;
    text-align: center;
}

.metric-card .value { font-size: 2rem; font-weight: 700; color: var(--color-primary); }
.metric-card.positive .value { color: var(--color-success); }
.metric-card.negative .value { color: var(--color-error); }

.chart-container {
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.callout { padding: 1rem 1.25rem; border-radius: 8px; margin: 1rem 0; }
.callout.info { background: #EFF6FF; border-left: 4px solid var(--color-primary); }
.callout.warning { background: #FFFBEB; border-left: 4px solid var(--color-warning); }
.callout.success { background: #ECFDF5; border-left: 4px solid var(--color-success); }

.report-footer {
    background: var(--color-bg);
    padding: 1.5rem 2.5rem;
    text-align: center;
    border-top: 1px solid var(--color-border);
    font-size: 0.875rem;
    color: var(--color-text-secondary);
}

@media print {
    body { background: white; padding: 0; }
    .report-container { box-shadow: none; }
    .section { page-break-inside: avoid; }
}
```

## HTML Report Generation Workflow

### Overview

**Generate HTML reports directly** using the write tool. Load images, convert to base64 inline, and write the complete HTML file in one step. Follow all branding guidelines and CSS styling from the template above.

### Image Locations

- **Logo**: `.cursor/assets/logo.png` (or `.jpg`, `.jpeg`, `.svg`) - Analytics Hub logo (base64 embed required)
- **Profile Image**: `.cursor/assets/logo.jpg` (base64 embed required)

### Direct Generation Approach

**Generate HTML files directly** - do NOT create Python scripts. Follow these steps:

1. **Load and convert images to base64:**
   - Use a Python one-liner via terminal to convert logo image to base64
   - Use a Python one-liner via terminal to convert profile image to base64
   - Store the base64 strings for embedding in HTML

2. **Load analysis data:**
   - Read JSON files from `analyses/{YYYY-MM-DD}_{analysis_slug}/data/` folder
   - Extract findings, metrics, and data points from the analysis

3. **Generate complete HTML:**
   - Use the **Full CSS Template** (lines 82-210 above) - include ALL CSS inline
   - Follow the **Required Section Structure** (lines 39-45)
   - Embed logo and profile images as base64 data URIs
   - Include all branding elements (header, footer, colors, typography)
   - Add charts using ECharts or Plotly via CDN
   - Make it self-contained (all CSS and JavaScript inline or via CDN)

4. **Write HTML file directly:**
   - Path: `analyses/{YYYY-MM-DD}_{analysis_slug}/deliverables/report.html`
   - Example: `analyses/2024-12-15_mrr-by-plan-analysis/deliverables/report.html`
   - Use the `write` tool to create the file

### Image Base64 Conversion

To convert images to base64, use Python inline commands:

**For logo:**
```bash
python -c "import base64; print('data:image/jpeg;base64,' + base64.b64encode(open('.cursor/assets/logo.jpg', 'rb').read()).decode())"
```

**For profile:**
```bash
python -c "import base64; print('data:image/jpeg;base64,' + base64.b64encode(open('.cursor/assets/logo.jpg', 'rb').read()).decode())"
```

**Note:** Adjust the MIME type (`image/jpeg`, `image/png`, `image/svg+xml`) based on the actual file format.

### HTML Structure Template

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{Analysis Title} - AI Analytics Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* Include ALL CSS from Full CSS Template (lines 82-210) */
        :root { /* ... all CSS variables ... */ }
        body { /* ... all body styles ... */ }
        /* ... all other CSS classes ... */
    </style>
</head>
<body>
    <div class="report-container">
        <div class="report-header">
            <img src="{logo_base64_data_uri}" alt="Analytics Hub Logo" class="logo">
            <div>
                <h1>{Analysis Title}</h1>
                <p>{Date} • Nimrod Fisher | AI Analytics Hub</p>
            </div>
            <img src="{profile_base64_data_uri}" alt="Nimrod Fisher" class="profile">
        </div>
        
        <div class="section">
            <div class="section-title">Executive Summary</div>
            <div class="executive-summary">
                <!-- Key findings -->
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Methodology</div>
            <!-- Data sources, approach, limitations -->
        </div>
        
        <div class="section">
            <div class="section-title">Findings</div>
            <!-- Analysis with visualizations -->
            <div class="chart-container">
                <div class="chart-title">Chart Title</div>
                <div id="chart1" class="chart"></div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Recommendations</div>
            <div class="recommendations">
                <!-- Actionable insights -->
            </div>
        </div>
        
        <div class="report-footer">
            The Analytics Team • ai-analytics-hub.com
        </div>
    </div>
    
    <script>
        // ECharts initialization and chart rendering
        // Load data from embedded JSON or inline data structures
    </script>
</body>
</html>
```

### Key Requirements

✅ **Self-contained HTML** - All CSS inline, external resources via CDN only
✅ **Branding compliance** - Use exact colors, fonts, and structure from guidelines
✅ **Logo embedding** - Logo must be embedded as base64 data URI
✅ **Profile image** - Profile image must be embedded as base64 data URI
✅ **Complete CSS** - Include ALL CSS from the Full CSS Template (lines 82-210)
✅ **Print-friendly** - Include print media queries
✅ **Chart support** - ECharts or Plotly via CDN for visualizations

### Anti-Patterns to Avoid

❌ **DON'T** create Python scripts - generate HTML directly
❌ **DON'T** skip CSS styling - include ALL CSS from the template
❌ **DON'T** use external CSS files - all CSS must be inline
❌ **DON'T** forget logo or profile images - both must be embedded
❌ **DON'T** save reports in workspace root - use `deliverables/` folder
❌ **DON'T** deviate from branding guidelines - follow colors, fonts, and structure exactly
